<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sliding Window Pattern</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #13131a;
    --surface2: #1c1c28;
    --border: #2a2a3d;
    --accent: #00e5ff;
    --accent2: #ff6b35;
    --accent3: #a259ff;
    --window-col: rgba(0,229,255,0.15);
    --window-border: #00e5ff;
    --text: #e8e8f0;
    --muted: #6b6b8a;
    --green: #00ffa3;
    --red: #ff4d6d;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    min-height: 100vh;
    padding: 40px 24px;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    top: -200px; left: -200px;
    width: 600px; height: 600px;
    background: radial-gradient(circle, rgba(0,229,255,0.04) 0%, transparent 70%);
    pointer-events: none;
  }

  .container { max-width: 900px; margin: 0 auto; }

  /* Header */
  .header { margin-bottom: 48px; }
  .tag {
    display: inline-block;
    background: rgba(0,229,255,0.1);
    border: 1px solid rgba(0,229,255,0.3);
    color: var(--accent);
    font-size: 11px;
    font-family: 'Space Mono', monospace;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 4px 12px;
    border-radius: 2px;
    margin-bottom: 16px;
  }
  h1 {
    font-size: clamp(32px, 6vw, 64px);
    font-weight: 800;
    line-height: 1;
    letter-spacing: -1px;
    margin-bottom: 12px;
  }
  h1 span { color: var(--accent); }
  .subtitle { color: var(--muted); font-size: 16px; max-width: 480px; line-height: 1.6; }

  /* Concept */
  .concept-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-left: 3px solid var(--accent);
    padding: 24px;
    border-radius: 4px;
    margin-bottom: 32px;
    font-size: 15px;
    line-height: 1.7;
    color: #c0c0d8;
  }
  .concept-card strong { color: var(--accent); }

  /* Section titles */
  .section-label {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .section-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  /* Variants */
  .variants { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 40px; }
  @media(max-width: 600px) { .variants { grid-template-columns: 1fr; } }
  .variant-btn {
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--muted);
    padding: 14px 18px;
    border-radius: 4px;
    cursor: pointer;
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    font-weight: 600;
    transition: all 0.2s;
    text-align: left;
    position: relative;
    overflow: hidden;
  }
  .variant-btn::before {
    content: '';
    position: absolute;
    bottom: 0; left: 0; right: 0;
    height: 2px;
    background: var(--accent);
    transform: scaleX(0);
    transition: transform 0.2s;
  }
  .variant-btn:hover { border-color: var(--accent); color: var(--text); }
  .variant-btn:hover::before { transform: scaleX(1); }
  .variant-btn.active { border-color: var(--accent); color: var(--accent); background: rgba(0,229,255,0.06); }
  .variant-btn.active::before { transform: scaleX(1); }
  .variant-btn small { display: block; color: var(--muted); font-size: 11px; font-weight: 400; margin-top: 3px; }

  /* Visualizer */
  .viz-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 28px;
    margin-bottom: 32px;
  }

  .problem-desc {
    font-size: 13px;
    color: var(--muted);
    margin-bottom: 20px;
    font-family: 'Space Mono', monospace;
    line-height: 1.5;
  }
  .problem-desc .highlight { color: var(--accent); }

  /* Array visual */
  .array-wrap { position: relative; margin-bottom: 32px; }
  .array-row {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    position: relative;
  }

  .cell {
    width: 52px; height: 52px;
    border: 1px solid var(--border);
    background: var(--surface2);
    display: flex; align-items: center; justify-content: center;
    font-family: 'Space Mono', monospace;
    font-size: 15px;
    font-weight: 700;
    border-radius: 4px;
    transition: all 0.3s ease;
    position: relative;
    flex-shrink: 0;
  }

  .cell.in-window {
    background: var(--window-col);
    border-color: var(--window-border);
    color: var(--accent);
    box-shadow: 0 0 12px rgba(0,229,255,0.15), inset 0 0 8px rgba(0,229,255,0.05);
  }
  .cell.window-left { border-left: 2px solid var(--accent); }
  .cell.window-right { border-right: 2px solid var(--accent); }
  .cell.pointer-left { border-bottom: 3px solid var(--green); }
  .cell.pointer-right { border-bottom: 3px solid var(--accent2); }

  .index-row {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    margin-top: 4px;
  }
  .idx {
    width: 52px;
    text-align: center;
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--muted);
    flex-shrink: 0;
  }
  .idx.left-ptr { color: var(--green); font-weight: 700; }
  .idx.right-ptr { color: var(--accent2); font-weight: 700; }

  /* Pointer labels */
  .pointer-labels {
    display: flex;
    gap: 20px;
    margin-top: 12px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
  }
  .ptr-label { display: flex; align-items: center; gap: 6px; }
  .ptr-dot { width: 8px; height: 8px; border-radius: 50%; }

  /* Stats row */
  .stats-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 12px;
    margin-bottom: 20px;
  }
  .stat-box {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 12px;
    text-align: center;
  }
  .stat-label { font-size: 10px; color: var(--muted); font-family: 'Space Mono', monospace; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 4px; }
  .stat-val { font-size: 22px; font-weight: 800; color: var(--accent); font-family: 'Space Mono', monospace; }
  .stat-val.green { color: var(--green); }
  .stat-val.orange { color: var(--accent2); }

  /* Log */
  .log-box {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 14px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    min-height: 44px;
    line-height: 1.6;
  }
  .log-box .log-accent { color: var(--accent); }
  .log-box .log-green { color: var(--green); }
  .log-box .log-orange { color: var(--accent2); }
  .log-box .log-purple { color: var(--accent3); }

  /* Controls */
  .controls {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
    margin-top: 20px;
  }
  .btn {
    padding: 10px 20px;
    border-radius: 3px;
    border: 1px solid var(--border);
    background: var(--surface2);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }
  .btn:hover { border-color: var(--accent); color: var(--accent); }
  .btn.primary {
    background: rgba(0,229,255,0.12);
    border-color: var(--accent);
    color: var(--accent);
  }
  .btn.primary:hover { background: rgba(0,229,255,0.2); }
  .btn:disabled { opacity: 0.4; cursor: not-allowed; }

  .speed-label { font-size: 12px; color: var(--muted); margin-left: 8px; }
  input[type=range] {
    accent-color: var(--accent);
    width: 80px;
  }

  /* Code */
  .code-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 32px;
  }
  .code-header {
    background: var(--surface2);
    border-bottom: 1px solid var(--border);
    padding: 12px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .code-title { font-size: 12px; font-weight: 600; color: var(--accent); font-family: 'Space Mono', monospace; }
  .lang-badge {
    font-size: 10px;
    font-family: 'Space Mono', monospace;
    background: rgba(0,229,255,0.1);
    border: 1px solid rgba(0,229,255,0.2);
    color: var(--accent);
    padding: 2px 8px;
    border-radius: 2px;
  }
  pre {
    padding: 20px;
    overflow-x: auto;
    font-family: 'Space Mono', monospace;
    font-size: 12px;
    line-height: 1.8;
    color: #c0c0d8;
  }
  .kw { color: var(--accent3); }
  .fn { color: var(--accent); }
  .cm { color: #4a4a6a; font-style: italic; }
  .num { color: var(--accent2); }
  .hl-line { background: rgba(0,229,255,0.07); display: block; margin: 0 -20px; padding: 0 20px; }

  /* Complexity */
  .complexity-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 40px; }
  @media(max-width: 500px) { .complexity-row { grid-template-columns: 1fr; } }
  .cx-box {
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 20px;
    border-radius: 4px;
    text-align: center;
  }
  .cx-label { font-size: 11px; color: var(--muted); font-family: 'Space Mono', monospace; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
  .cx-val { font-size: 28px; font-weight: 800; font-family: 'Space Mono', monospace; color: var(--green); }

  /* Use cases */
  .usecases { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; margin-bottom: 40px; }
  .uc-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 18px;
    transition: border-color 0.2s;
  }
  .uc-card:hover { border-color: var(--accent); }
  .uc-icon { font-size: 22px; margin-bottom: 10px; }
  .uc-title { font-size: 14px; font-weight: 700; margin-bottom: 6px; }
  .uc-desc { font-size: 12px; color: var(--muted); line-height: 1.5; }

  /* Tips */
  .tips-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  @media(max-width: 600px) { .tips-grid { grid-template-columns: 1fr; } }
  .tip {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 16px;
    font-size: 13px;
    line-height: 1.6;
    color: #c0c0d8;
  }
  .tip-num {
    font-family: 'Space Mono', monospace;
    color: var(--accent);
    font-size: 11px;
    font-weight: 700;
    margin-bottom: 6px;
  }
</style>
</head>
<body>
<div class="container">

  <!-- Header -->
  <div class="header">
    <div class="tag">Algorithm Pattern #02</div>
    <h1>Sliding<br><span>Window</span></h1>
    <p class="subtitle">Process subarrays or substrings efficiently by maintaining a dynamic window that expands or shrinks over data.</p>
  </div>

  <!-- Concept -->
  <div class="concept-card">
    Instead of recalculating from scratch for each subarray, a <strong>sliding window</strong> maintains a running result. As the window slides right, you <strong>add</strong> the incoming element and <strong>remove</strong> the outgoing one â€” turning O(nÂ·k) brute force into <strong>O(n)</strong>.
  </div>

  <!-- Variant Selector -->
  <div class="section-label">Choose Variant</div>
  <div class="variants">
    <button class="variant-btn active" onclick="setVariant('fixed')" id="btn-fixed">
      Fixed Window
      <small>Window size k stays constant</small>
    </button>
    <button class="variant-btn" onclick="setVariant('variable')" id="btn-variable">
      Variable Window
      <small>Window expands/shrinks on condition</small>
    </button>
  </div>

  <!-- Visualizer -->
  <div class="section-label">Live Visualizer</div>
  <div class="viz-card">
    <div class="problem-desc" id="prob-desc"></div>

    <div class="stats-row" id="stats-row"></div>

    <div class="array-wrap">
      <div class="array-row" id="array-row"></div>
      <div class="index-row" id="index-row"></div>
      <div class="pointer-labels" id="ptr-labels"></div>
    </div>

    <div class="log-box" id="log-box">Ready to animate...</div>

    <div class="controls">
      <button class="btn primary" id="play-btn" onclick="playPause()">â–¶ Play</button>
      <button class="btn" onclick="stepForward()">Step â†’</button>
      <button class="btn" onclick="resetViz()">â†º Reset</button>
      <span class="speed-label">Speed</span>
      <input type="range" min="1" max="5" value="3" id="speed-slider">
    </div>
  </div>

  <!-- Code -->
  <div class="section-label">Implementation</div>
  <div class="code-card" id="code-card">
    <div class="code-header">
      <span class="code-title" id="code-title"></span>
      <span class="lang-badge">Python</span>
    </div>
    <pre id="code-block"></pre>
  </div>

  <!-- Complexity -->
  <div class="section-label">Complexity</div>
  <div class="complexity-row">
    <div class="cx-box">
      <div class="cx-label">Time Complexity</div>
      <div class="cx-val">O(n)</div>
    </div>
    <div class="cx-box">
      <div class="cx-label">Space Complexity</div>
      <div class="cx-val">O(1)*</div>
    </div>
  </div>

  <!-- Use Cases -->
  <div class="section-label">When To Use</div>
  <div class="usecases">
    <div class="uc-card">
      <div class="uc-icon">ðŸ“Š</div>
      <div class="uc-title">Max/Min Subarray</div>
      <div class="uc-desc">Find max sum / min length subarray of size k or satisfying a condition.</div>
    </div>
    <div class="uc-card">
      <div class="uc-icon">ðŸ”¤</div>
      <div class="uc-title">Substring Problems</div>
      <div class="uc-desc">Longest substring without repeats, anagram checks, character frequency.</div>
    </div>
    <div class="uc-card">
      <div class="uc-icon">ðŸŒŠ</div>
      <div class="uc-title">Streaming Data</div>
      <div class="uc-desc">Moving averages, rate limiting, event monitoring over time windows.</div>
    </div>
    <div class="uc-card">
      <div class="uc-icon">ðŸŽ¯</div>
      <div class="uc-title">Two-Pointer Hybrid</div>
      <div class="uc-desc">Pair with two pointers to find pairs or triplets summing to a target.</div>
    </div>
  </div>

  <!-- Tips -->
  <div class="section-label">Pattern Recognition Tips</div>
  <div class="tips-grid">
    <div class="tip">
      <div class="tip-num">01 â€” IDENTIFY</div>
      If the problem asks for something about a <strong>contiguous subarray/substring</strong>, think sliding window first.
    </div>
    <div class="tip">
      <div class="tip-num">02 â€” FIXED vs VARIABLE</div>
      Fixed size k â†’ simple sliding. "At most / at least / exactly" constraints â†’ variable window with shrink condition.
    </div>
    <div class="tip">
      <div class="tip-num">03 â€” SHRINK CONDITION</div>
      For variable windows, define clearly <em>when</em> to move left pointer inward to restore validity.
    </div>
    <div class="tip">
      <div class="tip-num">04 â€” UPDATE ANSWER</div>
      Update the best answer at the moment the window is valid â€” typically after expansion or after shrinking.
    </div>
  </div>

</div>

<script>
// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let variant = 'fixed';
let steps = [];
let stepIdx = 0;
let playing = false;
let timer = null;

// â”€â”€â”€ Variant Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const VARIANTS = {
  fixed: {
    label: 'Max Sum Subarray of Size k',
    array: [2, 1, 5, 1, 3, 2, 6, 4, 1],
    k: 3,
    build: buildFixedSteps,
    stats: () => [
      { label: 'Window Size', key: 'winSize', cls: '' },
      { label: 'Window Sum', key: 'winSum', cls: 'orange' },
      { label: 'Max Sum', key: 'maxSum', cls: 'green' },
    ],
    code: {
      title: 'max_sum_subarray_k(arr, k)',
      html: `<span class="kw">def</span> <span class="fn">max_sum_subarray</span>(arr, k):
    window_sum = <span class="fn">sum</span>(arr[:<span class="num">k</span>])  <span class="cm"># seed first window</span>
    max_sum = window_sum

    <span class="kw">for</span> i <span class="kw">in</span> <span class="fn">range</span>(<span class="num">k</span>, <span class="fn">len</span>(arr)):
<span class="hl-line">        window_sum += arr[i] - arr[i - k]  <span class="cm"># slide: add right, drop left</span></span>
        max_sum = <span class="fn">max</span>(max_sum, window_sum)

    <span class="kw">return</span> max_sum`
    }
  },
  variable: {
    label: 'Longest Substring Without Repeating Characters',
    array: ['a','b','c','a','b','b','d','e','f'],
    build: buildVariableSteps,
    stats: () => [
      { label: 'Left (L)', key: 'left', cls: '' },
      { label: 'Right (R)', key: 'right', cls: 'orange' },
      { label: 'Best Len', key: 'best', cls: 'green' },
    ],
    code: {
      title: 'longest_no_repeat(s)',
      html: `<span class="kw">def</span> <span class="fn">longest_no_repeat</span>(s):
    seen = {}         <span class="cm"># char â†’ last index</span>
    left = <span class="num">0</span>
    best = <span class="num">0</span>

    <span class="kw">for</span> right, ch <span class="kw">in</span> <span class="fn">enumerate</span>(s):
        <span class="kw">if</span> ch <span class="kw">in</span> seen <span class="kw">and</span> seen[ch] >= left:
<span class="hl-line">            left = seen[ch] + <span class="num">1</span>  <span class="cm"># shrink: skip past duplicate</span></span>
        seen[ch] = right
        best = <span class="fn">max</span>(best, right - left + <span class="num">1</span>)

    <span class="kw">return</span> best`
    }
  }
};

// â”€â”€â”€ Fixed Steps â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildFixedSteps(arr, k) {
  const steps = [];
  let ws = arr.slice(0, k).reduce((a,b)=>a+b, 0);
  let maxSum = ws;
  steps.push({ left:0, right:k-1, winSum:ws, maxSum, log: `<span class="log-accent">Initial window</span> [0..${k-1}]: sum = <span class="log-orange">${ws}</span>`, type:'init' });

  for (let i = k; i < arr.length; i++) {
    const added = arr[i], removed = arr[i-k];
    ws = ws + added - removed;
    if (ws > maxSum) maxSum = ws;
    const msg = `Add <span class="log-orange">${added}</span>, Remove <span class="log-accent">${removed}</span> â†’ sum = <span class="log-orange">${ws}</span>, max = <span class="log-green">${maxSum}</span>`;
    steps.push({ left:i-k+1, right:i, winSum:ws, maxSum, log:msg, type:'slide' });
  }
  return steps;
}

// â”€â”€â”€ Variable Steps â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildVariableSteps(arr) {
  const steps = [];
  const seen = {};
  let left = 0, best = 0;
  steps.push({ left:0, right:-1, best:0, log:'<span class="log-accent">Start</span>: empty window', type:'init' });
  for (let right = 0; right < arr.length; right++) {
    const ch = arr[right];
    if (ch in seen && seen[ch] >= left) {
      const oldLeft = left;
      left = seen[ch] + 1;
      steps.push({ left, right: right-1, best, log:`<span class="log-orange">Duplicate '${ch}'</span> â€” shrink left from <span class="log-accent">${oldLeft}</span> to <span class="log-accent">${left}</span>`, type:'shrink' });
    }
    seen[ch] = right;
    const len = right - left + 1;
    if (len > best) best = len;
    steps.push({ left, right, best, log:`Expand right to <span class="log-orange">${ch}</span> â€” window length = <span class="log-accent">${len}</span>, best = <span class="log-green">${best}</span>`, type:'expand' });
  }
  return steps;
}

// â”€â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render(step) {
  const v = VARIANTS[variant];
  const arr = v.array;
  const row = document.getElementById('array-row');
  const idxRow = document.getElementById('index-row');
  const statsDef = v.stats();

  // Stats
  const sr = document.getElementById('stats-row');
  sr.innerHTML = statsDef.map(s => {
    let val;
    if (s.key === 'winSize') val = variant === 'fixed' ? VARIANTS.fixed.k : (step.right - step.left + 1);
    else if (s.key === 'winSum') val = step.winSum ?? 'â€”';
    else if (s.key === 'maxSum') val = step.maxSum ?? 'â€”';
    else if (s.key === 'left') val = Math.max(0, step.left);
    else if (s.key === 'right') val = Math.max(0, step.right);
    else if (s.key === 'best') val = step.best ?? 0;
    return `<div class="stat-box"><div class="stat-label">${s.label}</div><div class="stat-val ${s.cls}">${val}</div></div>`;
  }).join('');

  // Cells
  row.innerHTML = arr.map((v, i) => {
    let cls = 'cell';
    if (i >= step.left && i <= step.right) cls += ' in-window';
    if (i === step.left) cls += ' window-left';
    if (i === step.right) cls += ' window-right';
    return `<div class="${cls}">${v}</div>`;
  }).join('');

  // Index row
  idxRow.innerHTML = arr.map((_, i) => {
    let cls = 'idx';
    if (i === step.left) cls += ' left-ptr';
    if (i === step.right) cls += ' right-ptr';
    return `<div class="${cls}">${i === step.left ? 'L' : i === step.right ? 'R' : i}</div>`;
  }).join('');

  // Pointer labels
  document.getElementById('ptr-labels').innerHTML = `
    <div class="ptr-label"><div class="ptr-dot" style="background:var(--green)"></div><span style="color:var(--green);font-size:11px;font-family:'Space Mono',monospace">L = ${step.left}</span></div>
    <div class="ptr-label"><div class="ptr-dot" style="background:var(--accent2)"></div><span style="color:var(--accent2);font-size:11px;font-family:'Space Mono',monospace">R = ${Math.max(0,step.right)}</span></div>
  `;

  // Log
  document.getElementById('log-box').innerHTML = step.log;

  // Buttons
  document.getElementById('play-btn').textContent = playing ? 'â¸ Pause' : 'â–¶ Play';
}

function setVariant(v) {
  variant = v;
  document.querySelectorAll('.variant-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('btn-' + v).classList.add('active');
  // Update problem desc
  const descs = {
    fixed: 'Find the <span class="highlight">maximum sum</span> of any contiguous subarray of size <span class="highlight">k=3</span>.',
    variable: 'Find the <span class="highlight">longest substring</span> with no repeating characters.'
  };
  document.getElementById('prob-desc').innerHTML = descs[v];

  // Code
  const cd = VARIANTS[v].code;
  document.getElementById('code-title').textContent = cd.title;
  document.getElementById('code-block').innerHTML = cd.html;

  resetViz();
}

function resetViz() {
  clearInterval(timer);
  playing = false;
  stepIdx = 0;
  const v = VARIANTS[variant];
  steps = variant === 'fixed'
    ? buildFixedSteps(v.array, v.k)
    : buildVariableSteps(v.array);
  render(steps[0]);
  document.getElementById('play-btn').textContent = 'â–¶ Play';
}

function stepForward() {
  if (stepIdx < steps.length - 1) {
    stepIdx++;
    render(steps[stepIdx]);
  } else {
    stopPlay();
  }
}

function playPause() {
  if (playing) { stopPlay(); return; }
  playing = true;
  document.getElementById('play-btn').textContent = 'â¸ Pause';
  const speed = document.getElementById('speed-slider').value;
  const delay = [800, 600, 400, 250, 120][speed - 1];
  timer = setInterval(() => {
    if (stepIdx >= steps.length - 1) { stopPlay(); return; }
    stepIdx++;
    render(steps[stepIdx]);
  }, delay);
}

function stopPlay() {
  clearInterval(timer);
  playing = false;
  document.getElementById('play-btn').textContent = 'â–¶ Play';
}

// Init
setVariant('fixed');
</script>
</body>
</html>
